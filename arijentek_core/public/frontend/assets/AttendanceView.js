var N=(H,k,u)=>new Promise((m,c)=>{var x=r=>{try{h(u.next(r))}catch(p){c(p)}},C=r=>{try{h(u.throw(r))}catch(p){c(p)}},h=r=>r.done?m(r.value):Promise.resolve(r.value).then(x,C);h((u=u.apply(H,k)).next())});import{d as Y,r as _,x as K,m as I,a as o,b as e,f as R,y as q,F as g,n as y,g as v,h as f,t as l,i as $,C as T,p as w,o as n,q as b,j as E,s as W,k as z}from"./main.js";import{u as O,a as X,l as G}from"./api.js";import{_ as J,C as Q,a as Z,b as ee}from"./ClockWidget.vue_vue_type_script_setup_true_lang.js";import{C as te,a as se}from"./chevron-down.js";import{C as V}from"./clock.js";const ae={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 animate-fade-in"},ne={class:"flex items-center gap-2 shrink-0"},oe={class:"relative"},le=["value"],re={class:"glass-card p-6 sm:p-8 flex flex-col items-center justify-center mb-6"},ie={key:0,class:"flex items-center justify-center py-12"},de={key:1,class:"space-y-6 animate-slide-up"},ce={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},ue={class:"flex items-center justify-between mb-3"},me={class:"text-sm font-medium text-slate-400"},pe={key:0,class:"glass-card p-5"},xe={class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"},he={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},_e={class:"w-10 h-10 rounded-lg bg-amber-500/10 text-amber-400 flex items-center justify-center shrink-0"},ve={class:"min-w-0"},be={class:"text-sm font-medium text-white"},ge={class:"text-xs text-slate-500 truncate"},ye={key:0,class:"glass-card overflow-hidden"},fe={class:"hidden sm:block overflow-x-auto"},we={class:"w-full"},ke={class:"px-5 py-4"},Ce={class:"text-sm font-medium text-white"},De={class:"px-5 py-4 text-center"},$e={class:"px-5 py-4 text-center"},Ae={class:"text-sm text-slate-300"},He={class:"px-5 py-4 text-center"},Me={class:"text-sm text-slate-300"},Le={class:"px-5 py-4 text-center"},Se={class:"sm:hidden divide-y divide-white/[0.04]"},je={class:"flex items-center justify-between"},Fe={class:"text-sm font-medium text-white"},Ne={class:"flex items-center gap-4 text-xs text-slate-500"},Te={key:0},ze={key:1},Oe={key:1,class:"glass-card p-8 text-center"},Ie=Y({__name:"AttendanceView",setup(H){const k=_(!0),u=new Date,m=_(u.getMonth()+1),c=_(u.getFullYear()),x=_([]),C=_({}),h=_([]),r=w(()=>{const a=[],s=new Date;for(let i=-12;i<=2;i++){const t=new Date(s.getFullYear(),s.getMonth()+i,1),d=t.getMonth()+1,F=t.getFullYear();a.push({value:`${F}-${d}`,label:t.toLocaleDateString("en-US",{month:"long",year:"numeric"}),month:d,year:F})}return a}),p=w({get:()=>`${c.value}-${m.value}`,set:a=>{const[s,i]=a.split("-").map(Number);c.value=s,m.value=i}}),B=w(()=>`${c.value}-${String(m.value).padStart(2,"0")}`),M=w(()=>h.value.filter(a=>a.holiday_date.startsWith(B.value))),P=w(()=>{const a=C.value||{};return[{label:"Present",value:a.Present||0,icon:T,color:"text-emerald-400",bg:"bg-emerald-500/10"},{label:"Absent",value:a.Absent||0,icon:Q,color:"text-red-400",bg:"bg-red-500/10"},{label:"Half Day",value:a["Half Day"]||0,icon:Z,color:"text-amber-400",bg:"bg-amber-500/10"},{label:"On Leave",value:a["On Leave"]||0,icon:ee,color:"text-blue-400",bg:"bg-blue-500/10"}]});function L(a){return{Present:"text-emerald-400",Absent:"text-red-400","Half Day":"text-amber-400","On Leave":"text-blue-400"}[a]||"text-slate-400"}function S(a){return{Present:"badge-success",Absent:"badge-danger","Half Day":"badge-warning","On Leave":"badge-info"}[a]||"badge-neutral"}function D(a){if(!a)return"—";try{const s=new Date(a);return isNaN(s.getTime())?a:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(s){return a}}function j(a){try{return new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}catch(s){return a}}function A(){return N(this,null,function*(){const a=m.value,s=c.value,i=`attendance_${s}_${a}`;O(i,()=>X.getRecords(a,s),d=>{d&&(x.value=d.records||[],C.value=d.summary||{},k.value=!1)});const t=`holidays_${s}`;O(t,()=>G.getHolidays(`${s}-01-01`,`${s}-12-31`),d=>{Array.isArray(d)&&(h.value=d)})})}K([m,c],()=>{A()});function U(){A()}return I(A),(a,s)=>{var i;return n(),o("div",null,[e("div",ae,[s[2]||(s[2]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold text-white"},"Attendance"),e("p",{class:"text-sm text-slate-500 mt-1"},"Track your daily attendance and working hours")],-1)),e("div",ne,[s[1]||(s[1]=e("label",{class:"text-xs text-slate-500 whitespace-nowrap"},"Month:",-1)),e("div",oe,[R(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>p.value=t),class:"input-dark appearance-none pr-8 pl-3 py-2 text-sm cursor-pointer min-w-[180px] border border-white/10 rounded-lg"},[(n(!0),o(g,null,y(r.value,t=>(n(),o("option",{key:t.value,value:t.value},l(t.label),9,le))),128))],512),[[q,p.value]]),v(f(te),{size:14,class:"absolute right-2.5 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"})])])]),e("div",re,[s[3]||(s[3]=e("h2",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-6"},"Today's Clock",-1)),v(J,{onPunched:U})]),k.value?(n(),o("div",ie,[...s[4]||(s[4]=[e("div",{class:"w-10 h-10 border-2 border-accent/30 border-t-accent rounded-full animate-spin"},null,-1)])])):(n(),o("div",de,[e("div",ce,[(n(!0),o(g,null,y(P.value,t=>(n(),o("div",{key:t.label,class:"glass-card-hover p-5"},[e("div",ue,[e("span",me,l(t.label),1),e("div",{class:b([[t.bg,t.color],"w-9 h-9 rounded-xl flex items-center justify-center"])},[(n(),E(W(t.icon),{size:18,"stroke-width":1.8}))],2)]),e("p",{class:b(["stat-number",t.color])},l(t.value),3)]))),128))]),M.value.length?(n(),o("div",pe,[e("h3",xe," Holidays in "+l(((i=r.value.find(t=>t.value===p.value))==null?void 0:i.label)||"Selected Month"),1),e("div",he,[(n(!0),o(g,null,y(M.value,t=>(n(),o("div",{key:t.holiday_date,class:"flex items-center gap-3 py-2 px-3 rounded-lg bg-white/[0.03] border border-white/[0.04]"},[e("div",_e,[v(f(se),{size:18,"stroke-width":1.8})]),e("div",ve,[e("p",be,l(new Date(t.holiday_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1),e("p",ge,l(t.description||"Holiday"),1)])]))),128))])])):$("",!0),e("div",null,[s[7]||(s[7]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"}," Attendance Records ",-1)),x.value.length?(n(),o("div",ye,[e("div",fe,[e("table",we,[s[5]||(s[5]=e("thead",null,[e("tr",{class:"border-b border-white/[0.06]"},[e("th",{class:"text-left text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Date"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Status"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"In Time"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Out Time"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Hours")])],-1)),e("tbody",null,[(n(!0),o(g,null,y(x.value,t=>(n(),o("tr",{key:t.date,class:"border-b border-white/[0.03] hover:bg-white/[0.02] transition-colors"},[e("td",ke,[e("p",Ce,l(j(t.date)),1)]),e("td",De,[e("span",{class:b(S(t.status))},l(t.status),3)]),e("td",$e,[e("span",Ae,l(D(t.in_time)),1)]),e("td",He,[e("span",Me,l(D(t.out_time)),1)]),e("td",Le,[e("span",{class:b(["text-sm font-semibold",L(t.status)])},l(t.working_hours>0?t.working_hours.toFixed(1)+"h":"—"),3)])]))),128))])])]),e("div",Se,[(n(!0),o(g,null,y(x.value,t=>(n(),o("div",{key:t.date,class:"p-4 space-y-2"},[e("div",je,[e("p",Fe,l(j(t.date)),1),e("span",{class:b(S(t.status))},l(t.status),3)]),e("div",Ne,[t.in_time?(n(),o("span",Te,[v(f(V),{size:12,class:"inline mr-1"}),z("In: "+l(D(t.in_time)),1)])):$("",!0),t.out_time?(n(),o("span",ze,[v(f(V),{size:12,class:"inline mr-1"}),z("Out: "+l(D(t.out_time)),1)])):$("",!0),t.working_hours>0?(n(),o("span",{key:2,class:b(L(t.status))},l(t.working_hours.toFixed(1))+"h ",3)):$("",!0)])]))),128))])])):(n(),o("div",Oe,[v(f(T),{size:32,class:"mx-auto text-slate-600 mb-2"}),s[6]||(s[6]=e("p",{class:"text-slate-500 text-sm"},"No attendance records for this month",-1))]))])]))])}}});export{Ie as default};
