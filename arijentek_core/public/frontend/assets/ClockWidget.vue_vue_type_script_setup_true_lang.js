var x=(c,m,s)=>new Promise((i,u)=>{var l=e=>{try{a(s.next(e))}catch(d){u(d)}},t=e=>{try{a(s.throw(e))}catch(d){u(d)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(l,t);a((s=s.apply(c,m)).next())});import{c as b,z as U,x as $,r as p,d as H,u as R,m as W,A as J,o,a as r,h as _,g as X,k as w,t as y,i as M,b as h,B as G,q as K,F as Q,p as f}from"./main.js";import{a as I}from"./api.js";/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=b("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=b("calendar-heart",[["path",{d:"M12.127 22H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v5.125",key:"vxdnp4"}],["path",{d:"M14.62 18.8A2.25 2.25 0 1 1 18 15.836a2.25 2.25 0 1 1 3.38 2.966l-2.626 2.856a.998.998 0 0 1-1.507 0z",key:"15cy7q"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=b("calendar-x",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=b("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Z=U("offline",()=>{const c=p([]),m=p(!1),s=p(""),i=localStorage.getItem("arijentek_offline_punches");if(i)try{c.value=JSON.parse(i)}catch(t){console.error("Failed to parse offline punches",t)}$(c,t=>{localStorage.setItem("arijentek_offline_punches",JSON.stringify(t))},{deep:!0});function u(){c.value.push({id:crypto.randomUUID(),timestamp:new Date().toISOString(),type:"IN"})}function l(){return x(this,null,function*(){if(c.value.length===0||m.value)return;m.value=!0,s.value="";const t=[...c.value];t.sort((a,e)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime());try{for(const a of t){console.log(`Syncing punch from ${a.timestamp}...`);const e=yield I.punch(a.timestamp);if(e.status==="success"||e.error&&e.error.includes("already clocked"))c.value=c.value.filter(d=>d.id!==a.id);else{console.error("Sync failed for punch",a,e.error),s.value=e.error||"Sync failed";break}}}catch(a){s.value=a.message||"Network error during sync"}finally{m.value=!1}})}return{pendingPunches:c,isSyncing:m,lastSyncError:s,addPunch:u,sync:l}}),ee={class:"flex flex-col items-center"},te={key:0,class:"mb-4 px-3 py-1 bg-amber-500/10 text-amber-400 border border-amber-500/20 rounded-full text-xs font-medium flex items-center gap-2 animate-pulse"},ae={class:"relative mb-6"},ne={width:"200",height:"200",class:"transform -rotate-90"},se=["stroke","stroke-dashoffset"],le=["disabled"],oe={key:0,class:"w-6 h-6 border-2 border-current border-t-transparent rounded-full animate-spin"},re={class:"text-[11px] font-semibold uppercase tracking-wider opacity-70"},ce={key:0,class:"text-2xl font-bold tabular-nums tracking-tight"},ie={key:1,xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},ue={class:"text-center space-y-1.5"},de={key:0,class:"badge-success mb-2"},ve={key:1,class:"badge-success mb-2"},he={key:2,class:"text-sm text-slate-400"},fe={class:"text-white font-medium"},pe={key:3,class:"text-sm text-slate-400"},me={class:"text-white font-medium"},ye={key:4,class:"text-sm text-slate-500"},ke={key:1,class:"mt-3 text-xs text-red-400 text-center max-w-[220px]"},ge=8*60*60,D=82,Me=H({__name:"ClockWidget",emits:["punched"],setup(c,{emit:m}){R();const s=Z(),i=p(!1),u=p(""),l=p(!1),t=p(!1),a=p(null),e=p(0);let d=null;const T=f(()=>e.value===0?0:Math.min(e.value/ge,1)),g=f(()=>T.value>=1),P=2*Math.PI*D,E=f(()=>P*(1-T.value)),N=f(()=>{const n=Math.floor(e.value/3600),v=Math.floor(e.value%3600/60),A=e.value%60;return`${String(n).padStart(2,"0")}:${String(v).padStart(2,"0")}:${String(A).padStart(2,"0")}`}),S=f(()=>a.value?a.value.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""),O=f(()=>t.value||g.value?"#22c55e":"#ef4444"),L=f(()=>t.value||g.value?"rgba(34, 197, 94, 0.35)":"rgba(239, 68, 68, 0.25)"),j=f(()=>t.value?"Day Complete":l.value?"Clock Out":"Clock In"),B=f(()=>i.value||t.value);function C(){k(),d=setInterval(()=>{a.value&&(e.value=Math.floor((Date.now()-a.value.getTime())/1e3))},1e3)}function k(){d&&(clearInterval(d),d=null)}let z=!1;function F(){return x(this,null,function*(){if(!z){z=!0;try{const n=yield I.getTodayCheckin();n.clock_in&&n.clock_out?(t.value=!0,l.value=!1,a.value=new Date(n.clock_in),e.value=Math.floor((new Date(n.clock_out).getTime()-new Date(n.clock_in).getTime())/1e3),k()):n.clock_in&&!n.clock_out?(l.value=!0,t.value=!1,a.value=new Date(n.clock_in),e.value=Math.floor((Date.now()-a.value.getTime())/1e3),C()):(l.value=!1,t.value=!1,a.value=null,e.value=0)}catch(n){}}})}function V(){return x(this,null,function*(){if(!t.value){i.value=!0,u.value="";try{if(!navigator.onLine){s.addPunch(),i.value=!1,l.value?(l.value=!1,t.value=!0,k()):(l.value=!0,a.value=new Date,C());return}const n=yield I.punch();n.status==="success"?(n.log_type==="IN"?(l.value=!0,t.value=!1,a.value=new Date(n.time),e.value=0,C()):(l.value=!1,t.value=!0,k()),q("punched")):u.value=n.error||"Punch failed"}catch(n){u.value=n.message||"Something went wrong"}finally{i.value=!1}}})}W(()=>{F(),window.addEventListener("online",s.sync),setInterval(()=>{navigator.onLine&&s.pendingPunches.length&&s.sync()},6e4)}),J(()=>{k(),window.removeEventListener("online",s.sync)});const q=m;return(n,v)=>(o(),r("div",ee,[_(s).pendingPunches.length>0?(o(),r("div",te,[X(_(Y),{size:12}),w(" "+y(_(s).pendingPunches.length)+" Pending Punch"+y(_(s).pendingPunches.length!==1?"es":""),1)])):M("",!0),h("div",ae,[(o(),r("svg",ne,[h("circle",{cx:100,cy:100,r:D,fill:"none",class:"clock-ring-bg","stroke-width":"6"}),h("circle",{cx:100,cy:100,r:D,fill:"none",stroke:O.value,"stroke-width":"6","stroke-linecap":"round",class:"clock-ring-progress","stroke-dasharray":P,"stroke-dashoffset":E.value},null,8,se)])),h("button",{onClick:V,disabled:B.value,class:K(["absolute inset-0 m-auto w-[140px] h-[140px] rounded-full flex flex-col items-center justify-center gap-1 transition-all duration-500 focus:outline-none",[t.value?"bg-emerald-500/15 text-emerald-400 cursor-default":l.value?g.value?"bg-emerald-500/15 text-emerald-400 hover:bg-emerald-500/25":"bg-red-500/10 text-red-400 hover:bg-red-500/20":"bg-white/[0.05] text-slate-300 hover:bg-white/[0.08] hover:text-white"]]),style:G(l.value||t.value?{boxShadow:`0 0 40px ${L.value}`}:{})},[i.value?(o(),r("div",oe)):(o(),r(Q,{key:1},[h("span",re,y(j.value),1),l.value||t.value?(o(),r("span",ce,y(N.value),1)):(o(),r("svg",ie,[...v[0]||(v[0]=[h("circle",{cx:"12",cy:"12",r:"10"},null,-1),h("polyline",{points:"12 6 12 12 16 14"},null,-1)])]))],64))],14,le)]),h("div",ue,[t.value?(o(),r("div",de," Day Complete ")):g.value&&l.value?(o(),r("div",ve," Shift Complete ")):M("",!0),t.value&&S.value?(o(),r("p",he,[v[1]||(v[1]=w(" Worked ",-1)),h("span",fe,y(N.value),1),v[2]||(v[2]=w(" today ",-1))])):l.value&&S.value?(o(),r("p",pe,[v[3]||(v[3]=w(" Clocked in at ",-1)),h("span",me,y(S.value),1)])):(o(),r("p",ye," Tap to start your shift "))]),u.value?(o(),r("p",ke,y(u.value),1)):M("",!0)]))}});export{Ce as C,Me as _,be as a,Se as b};
