var j=(V,z,y)=>new Promise((w,g)=>{var M=m=>{try{k(y.next(m))}catch(f){g(f)}},v=m=>{try{k(y.throw(m))}catch(f){g(f)}},k=m=>m.done?w(m.value):Promise.resolve(m.value).then(M,v);k((y=y.apply(V,z)).next())});import{c as K,d as ae,r as p,m as le,a as l,b as e,g as d,h as c,k as _,t as o,i,f as L,y as q,F as h,n as A,T as oe,B as Y,D as I,p as $,o as a,q as B,w as W,X,v as N,E as ne,j as re}from"./main.js";import{l as D,d as ie}from"./api.js";import{B as de}from"./briefcase.js";import{C as G}from"./chevron-down.js";import{C as J}from"./calendar.js";import{C as ue,L as ce}from"./loader-circle.js";import{C as me}from"./circle-check.js";/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=K("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=K("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),xe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 animate-fade-in"},ye={key:0,class:"flex items-center justify-center py-20"},ge={key:1,class:"space-y-6 animate-slide-up"},fe={key:0,class:"glass-card p-5"},be={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},_e={key:0,class:"flex items-center gap-3"},he={class:"w-10 h-10 rounded-xl bg-blue-500/10 text-blue-400 flex items-center justify-center"},we={class:"text-sm font-medium text-white"},ke={class:"text-xs text-slate-500"},Ce={key:1,class:"flex items-center gap-3"},Se={class:"w-10 h-10 rounded-xl bg-purple-500/10 text-purple-400 flex items-center justify-center"},Le={class:"text-sm font-medium text-white"},Ae={class:"text-xs text-slate-500"},De={key:1,class:"glass-card p-5"},ze={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4"},Me={class:"flex items-center gap-2 shrink-0"},Te={class:"relative"},Ue=["value"],je={class:"relative"},Be={class:"holidays-scroll grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 max-h-64 overflow-y-auto overflow-x-hidden",style:{"scrollbar-width":"thin","scrollbar-color":"rgb(71 85 105) rgba(255,255,255,0.03)"}},Fe={class:"w-10 h-10 rounded-lg bg-amber-500/10 text-amber-400 flex items-center justify-center shrink-0"},$e={class:"min-w-0"},Ne={class:"text-sm font-medium text-white"},Ve={class:"text-xs text-slate-500 truncate"},Re={key:0,class:"text-sm text-slate-500 py-6 text-center"},He={key:0,class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4"},Ee=["title"],Pe={class:"glass-card p-5 border-accent/20"},Oe={class:"text-3xl font-bold text-accent"},qe={key:1,class:"glass-card p-8 text-center"},Ye={key:0,class:"glass-card overflow-hidden"},Ie={class:"hidden sm:block overflow-x-auto"},We={class:"w-full"},Xe={class:"px-5 py-4"},Ge={class:"text-sm font-medium text-white"},Je={class:"px-5 py-4"},Ke={class:"text-sm text-slate-300"},Qe={class:"px-5 py-4 text-center"},Ze={class:"text-sm font-semibold text-white"},et={class:"px-5 py-4 text-center"},tt={class:"px-5 py-4 text-right"},st=["onClick"],at={class:"sm:hidden divide-y divide-white/[0.04]"},lt={class:"flex items-center justify-between"},ot={class:"text-sm font-medium text-white"},nt={class:"text-xs text-slate-500"},rt=["onClick"],it={key:1,class:"glass-card p-8 text-center"},dt={class:"modal-content glass-card w-full max-w-md p-6 space-y-5"},ut={class:"flex items-center justify-between"},ct={class:"relative"},mt=["disabled"],pt=["value"],vt={key:0,value:"",disabled:""},xt={key:0,class:"text-xs text-slate-500 mt-1"},yt={class:"grid grid-cols-2 gap-3"},gt={class:"flex items-center gap-3 cursor-pointer"},ft={key:0,class:"flex items-start gap-2 text-sm text-red-400 bg-red-500/10 p-3 rounded-xl"},bt=["disabled"],_t={key:0,class:"fixed bottom-24 lg:bottom-8 left-1/2 -translate-x-1/2 z-50 flex items-center gap-2 bg-emerald-500/15 border border-emerald-500/20 text-emerald-400 px-5 py-3 rounded-xl shadow-lg"},ht={class:"text-sm font-medium"},Mt=ae({__name:"LeaveView",setup(V){const z=p(!0),y=p([]),w=p([]),g=p([]),M=p([]),v=p(null),k=new Date,m=p(`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}`),f=p(!1),T=p(!1),C=p(""),S=p(""),r=p({leave_type:"",from_date:"",to_date:"",half_day:0,reason:""}),Q=$(()=>y.value.reduce((n,t)=>n+t.balance,0)),Z=$(()=>{const t=new Date().getFullYear(),x=[{value:"",label:"All months"}];for(let u=t;u<=t+1;u++)for(let s=1;s<=12;s++){const b=`${u}-${String(s).padStart(2,"0")}`,U=new Date(u,s-1,1);x.push({value:b,label:U.toLocaleDateString("en-US",{month:"long",year:"numeric"})})}return x}),R=$(()=>{const n=M.value;return m.value?n.filter(t=>t.holiday_date.startsWith(m.value)):n}),H=[{bg:"bg-teal-500/10",text:"text-teal-400",ring:"ring-teal-500/20"},{bg:"bg-blue-500/10",text:"text-blue-400",ring:"ring-blue-500/20"},{bg:"bg-purple-500/10",text:"text-purple-400",ring:"ring-purple-500/20"},{bg:"bg-amber-500/10",text:"text-amber-400",ring:"ring-amber-500/20"},{bg:"bg-rose-500/10",text:"text-rose-400",ring:"ring-rose-500/20"},{bg:"bg-emerald-500/10",text:"text-emerald-400",ring:"ring-emerald-500/20"}];function E(n){return H[n%H.length]}function P(n){return{Open:"badge-warning",Approved:"badge-success",Rejected:"badge-danger",Cancelled:"badge-neutral"}[n]||"badge-neutral"}function ee(){const t=new Date().getFullYear(),x=`${t}-01-01`,u=`${t}-12-31`;return{from:x,to:u}}function F(){return j(this,null,function*(){z.value=!0;try{const{from:n,to:t}=ee(),[x,u,s,b,U]=yield Promise.allSettled([D.getBalance(),D.getApplications(),D.getTypes(),ie.getReportingInfo(),D.getHolidays(n,t,!0)]);x.status==="fulfilled"&&(y.value=Array.isArray(x.value)?x.value:[]),u.status==="fulfilled"&&(w.value=Array.isArray(u.value)?u.value:[]),s.status==="fulfilled"&&(g.value=Array.isArray(s.value)?s.value:[]),b.status==="fulfilled"&&(v.value=b.value),U.status==="fulfilled"&&(M.value=Array.isArray(U.value)?U.value:[])}finally{z.value=!1}})}function te(){r.value={leave_type:g.value[0]||"",from_date:"",to_date:"",half_day:0,reason:""},C.value="",S.value="",f.value=!0}function se(){return j(this,null,function*(){T.value=!0,C.value="",S.value="";try{const n=yield D.apply(r.value);n.success?(S.value=`Leave application ${n.name} submitted successfully!`,f.value=!1,yield F()):C.value=n.error||"Failed to submit"}catch(n){C.value=n.message||"Something went wrong"}finally{T.value=!1}})}function O(n){return j(this,null,function*(){if(confirm("Cancel this leave application?"))try{(yield D.cancel(n)).success&&(yield F())}catch(t){alert(t.message||"Failed to cancel")}})}return le(F),(n,t)=>{var x,u;return a(),l("div",null,[e("div",xe,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold text-white"},"Leave Management"),e("p",{class:"text-sm text-slate-500 mt-1"},"Track, apply and manage your leaves")],-1)),e("button",{onClick:te,class:"btn-accent flex items-center gap-2 self-start"},[d(c(pe),{size:18}),t[9]||(t[9]=_(" Apply Leave ",-1))])]),z.value?(a(),l("div",ye,[...t[11]||(t[11]=[e("div",{class:"w-10 h-10 border-2 border-accent/30 border-t-accent rounded-full animate-spin"},null,-1)])])):(a(),l("div",ge,[(x=v.value)!=null&&x.reporting_manager||(u=v.value)!=null&&u.leave_approver?(a(),l("div",fe,[t[14]||(t[14]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"},"Reporting & Approval",-1)),e("div",be,[v.value.reporting_manager?(a(),l("div",_e,[e("div",he,[d(c(ve),{size:18,"stroke-width":1.8})]),e("div",null,[t[12]||(t[12]=e("p",{class:"text-xs text-slate-500"},"Reporting Manager",-1)),e("p",we,o(v.value.reporting_manager.employee_name),1),e("p",ke,o(v.value.reporting_manager.designation),1)])])):i("",!0),v.value.leave_approver?(a(),l("div",Ce,[e("div",Se,[d(c(de),{size:18,"stroke-width":1.8})]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-xs text-slate-500"},"Leave Approver",-1)),e("p",Le,o(v.value.leave_approver.employee_name),1),e("p",Ae,o(v.value.leave_approver.designation),1)])])):i("",!0)])])):i("",!0),M.value.length?(a(),l("div",De,[e("div",ze,[t[16]||(t[16]=e("div",null,[e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider"},"Company Holidays"),e("p",{class:"text-xs text-slate-500 mt-1"},"Holidays from your assigned Holiday List in ERPNext")],-1)),e("div",Me,[t[15]||(t[15]=e("label",{class:"text-xs text-slate-500 whitespace-nowrap"},"Filter by month:",-1)),e("div",Te,[L(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"input-dark appearance-none pr-8 pl-3 py-2 text-sm cursor-pointer min-w-[160px] border border-white/10 rounded-lg"},[(a(!0),l(h,null,A(Z.value,s=>(a(),l("option",{key:s.value,value:s.value},o(s.label),9,Ue))),128))],512),[[q,m.value]]),d(c(G),{size:14,class:"absolute right-2.5 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"})])])]),e("div",je,[e("div",Be,[(a(!0),l(h,null,A(R.value,s=>(a(),l("div",{key:s.holiday_date,class:"flex items-center gap-3 py-2 px-3 rounded-lg bg-white/[0.03] border border-white/[0.04]"},[e("div",Fe,[d(c(J),{size:18,"stroke-width":1.8})]),e("div",$e,[e("p",Ne,o(new Date(s.holiday_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1),e("p",Ve,o(s.description||"Holiday"),1)])]))),128))]),R.value.length===0?(a(),l("p",Re," No holidays in selected month ")):i("",!0)])])):i("",!0),e("div",null,[t[21]||(t[21]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"},"Leave Balance",-1)),t[22]||(t[22]=e("p",{class:"text-xs text-slate-500 mb-4"},"Casual Leave, Sick Leave, Earned Leave (1 per 20 working days), Regional Holidays",-1)),y.value.length?(a(),l("div",He,[(a(!0),l(h,null,A(y.value,(s,b)=>(a(),l("div",{key:s.leave_type,class:B(["glass-card-hover p-5 ring-1",E(b).ring])},[e("p",{class:"text-sm font-medium text-slate-400 mb-2 truncate",title:s.leave_type},o(s.leave_type),9,Ee),e("p",{class:B(["text-3xl font-bold",E(b).text])},o(s.balance),3),t[17]||(t[17]=e("p",{class:"text-xs text-slate-500 mt-1"},"days",-1))],2))),128)),e("div",Pe,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-slate-400 mb-2"},"Total",-1)),e("p",Oe,o(Q.value),1),t[19]||(t[19]=e("p",{class:"text-xs text-slate-500 mt-1"},"days remaining",-1))])])):(a(),l("div",qe,[d(c(oe),{size:32,class:"mx-auto text-slate-600 mb-2"}),t[20]||(t[20]=e("p",{class:"text-slate-500 text-sm"},"No leave balance data available",-1))]))]),e("div",null,[t[25]||(t[25]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"}," My Applications ",-1)),w.value.length?(a(),l("div",Ye,[e("div",Ie,[e("table",We,[t[23]||(t[23]=e("thead",null,[e("tr",{class:"border-b border-white/[0.06]"},[e("th",{class:"text-left text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Type"),e("th",{class:"text-left text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Period"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Days"),e("th",{class:"text-center text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Status"),e("th",{class:"text-right text-xs font-semibold text-slate-500 uppercase tracking-wider px-5 py-3"},"Action")])],-1)),e("tbody",null,[(a(!0),l(h,null,A(w.value,s=>(a(),l("tr",{key:s.name,class:"border-b border-white/[0.03] hover:bg-white/[0.02] transition-colors"},[e("td",Xe,[e("p",Ge,o(s.leave_type),1)]),e("td",Je,[e("p",Ke,[_(o(new Date(s.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" ",1),s.from_date!==s.to_date?(a(),l(h,{key:0},[_(" — "+o(new Date(s.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),1)],64)):i("",!0)])]),e("td",Qe,[e("span",Ze,o(s.total_leave_days),1)]),e("td",et,[e("span",{class:B(P(s.status))},o(s.status),3)]),e("td",tt,[s.status==="Open"?(a(),l("button",{key:0,onClick:b=>O(s.name),class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Cancel ",8,st)):i("",!0)])]))),128))])])]),e("div",at,[(a(!0),l(h,null,A(w.value,s=>(a(),l("div",{key:s.name,class:"p-4 space-y-2"},[e("div",lt,[e("p",ot,o(s.leave_type),1),e("span",{class:B(P(s.status))},o(s.status),3)]),e("p",nt,[_(o(new Date(s.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" ",1),s.from_date!==s.to_date?(a(),l(h,{key:0},[_(" — "+o(new Date(s.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),1)],64)):i("",!0),_(" · "+o(s.total_leave_days)+" day"+o(s.total_leave_days!==1?"s":""),1)]),s.status==="Open"?(a(),l("button",{key:0,onClick:b=>O(s.name),class:"text-xs text-red-400 hover:text-red-300"},"Cancel",8,rt)):i("",!0)]))),128))])])):(a(),l("div",it,[d(c(J),{size:32,class:"mx-auto text-slate-600 mb-2"}),t[24]||(t[24]=e("p",{class:"text-slate-500 text-sm"},"No leave applications yet",-1))]))])])),d(I,{name:"modal"},{default:Y(()=>[f.value?(a(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:t[7]||(t[7]=W(s=>f.value=!1,["self"]))},[e("div",dt,[e("div",ut,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold text-white"},"Apply for Leave",-1)),e("button",{onClick:t[1]||(t[1]=s=>f.value=!1),class:"text-slate-500 hover:text-white transition-colors p-1"},[d(c(X),{size:20})])]),e("form",{onSubmit:W(se,["prevent"]),class:"space-y-4"},[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-slate-400 mb-1.5"},"Leave Type",-1)),e("div",ct,[L(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.leave_type=s),class:"input-dark appearance-none pr-10 cursor-pointer",disabled:!g.value.length},[t[27]||(t[27]=e("option",{value:"",disabled:""},"Select leave type",-1)),(a(!0),l(h,null,A(g.value,s=>(a(),l("option",{key:s,value:s},o(s),9,pt))),128)),g.value.length?i("",!0):(a(),l("option",vt,"No leave types in ERPNext"))],8,mt),[[q,r.value.leave_type]]),d(c(G),{size:16,class:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"})]),g.value.length?(a(),l("p",xt,"Leave types from ERPNext")):i("",!0)]),e("div",yt,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-slate-400 mb-1.5"},"From",-1)),L(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=s=>r.value.from_date=s),required:"",class:"input-dark"},null,512),[[N,r.value.from_date]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-slate-400 mb-1.5"},"To",-1)),L(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.to_date=s),required:"",class:"input-dark"},null,512),[[N,r.value.to_date]])])]),e("label",gt,[L(e("input",{type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.half_day=s),class:"w-4 h-4 rounded border-white/10 bg-white/5 text-accent focus:ring-accent/30"},null,512),[[ne,r.value.half_day]]),t[31]||(t[31]=e("span",{class:"text-sm text-slate-400"},"Half day",-1))]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-slate-400 mb-1.5"},[_("Reason "),e("span",{class:"text-slate-600"},"(optional)")],-1)),L(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.reason=s),rows:"3",class:"input-dark resize-none",placeholder:"Briefly describe the reason..."},null,512),[[N,r.value.reason]])]),C.value?(a(),l("div",ft,[d(c(ue),{size:16,class:"mt-0.5 shrink-0"}),_(" "+o(C.value),1)])):i("",!0),e("button",{type:"submit",disabled:T.value||!r.value.leave_type||!r.value.from_date||!r.value.to_date,class:"btn-accent w-full flex items-center justify-center gap-2"},[T.value?(a(),re(c(ce),{key:0,size:18,class:"animate-spin"})):i("",!0),e("span",null,o(T.value?"Submitting...":"Submit Application"),1)],8,bt)],32)])])):i("",!0)]),_:1}),d(I,{name:"modal"},{default:Y(()=>[S.value?(a(),l("div",_t,[d(c(me),{size:18}),e("span",ht,o(S.value),1),e("button",{onClick:t[8]||(t[8]=s=>S.value=""),class:"ml-2 text-emerald-400/60 hover:text-emerald-400"},[d(c(X),{size:16})])])):i("",!0)]),_:1})])}}});export{Mt as default};
