var w=(E,g,f)=>new Promise((y,c)=>{var l=i=>{try{n(f.next(i))}catch(b){c(b)}},v=i=>{try{n(f.throw(i))}catch(b){c(b)}},n=i=>i.done?y(i.value):Promise.resolve(i.value).then(l,v);n((f=f.apply(E,g)).next())});import{c as V,d as q,m as R,a,b as t,g as d,h as u,k as h,t as m,X as M,i as k,F as _,n as C,w as U,f as S,y as B,v as j,r as p,o as r,K as $,q as I}from"./main.js";import{e as z}from"./api.js";import{P as L}from"./plus.js";import{C as X}from"./circle-check-big.js";import{R as A}from"./receipt.js";import{C as H}from"./circle-alert.js";import{C as K}from"./clock.js";/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=V("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),G={class:"space-y-6"},J={class:"flex items-center justify-between animate-fade-in"},Q={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 flex items-center gap-2"},W={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Y={key:2,class:"glass-card p-12 text-center text-slate-500 flex flex-col items-center"},Z={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 animate-slide-up"},ee={class:"flex justify-between items-start mb-4"},te={class:"p-3 rounded-lg bg-indigo-500/10 text-indigo-400"},se={class:"mb-4"},le={class:"text-2xl font-bold text-white"},oe={class:"text-xs text-slate-500 mt-1"},ae={class:"flex items-center justify-between text-xs text-slate-400 border-t border-white/5 pt-3"},re={class:"flex items-center gap-1.5"},ie={key:4,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ne={class:"glass-card w-full max-w-lg p-6 relative animate-scale-in"},de={class:"text-xl font-bold text-white mb-6 flex items-center gap-2"},ue={key:0,class:"p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm flex items-center gap-2"},pe=["value"],ce={class:"text-sm text-slate-300"},me=["disabled"],fe={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},xe={key:1},Ce=q({__name:"ExpenseView",setup(E){const g=p([]),f=p([]),y=p(!0),c=p(!1),l=p({expense_type:"",amount:"",description:"",proof:null}),v=p(!1),n=p(""),i=p(""),b=p(null);function D(){return w(this,null,function*(){y.value=!0;try{const[o,e]=yield Promise.all([z.getMyExpenses(),z.getTypes()]);g.value=Array.isArray(o)?o:[],f.value=Array.isArray(e)?e:[]}catch(o){console.error(o)}finally{y.value=!1}})}function F(o){const e=o.target;e.files&&e.files.length>0&&(l.value.proof=e.files[0])}function N(o){return w(this,null,function*(){const e=new FormData;e.append("file",o,o.name),e.append("is_private","1");const x=yield(yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":window.csrf_token||""},body:e})).json();if(x.message&&x.message.file_url)return x.message.file_url;throw new Error(x.message||"Upload failed")})}function P(){return w(this,null,function*(){if(!l.value.expense_type||!l.value.amount||!l.value.description){n.value="Please fill all required fields";return}v.value=!0,n.value="";try{let o="";l.value.proof&&(o=yield N(l.value.proof));const e={expense_type:l.value.expense_type,amount:l.value.amount,description:l.value.description,proof:o},s=yield z.submit(e);s.success?(i.value="Expense submitted successfully",c.value=!1,l.value={expense_type:"",amount:"",description:"",proof:null},D()):n.value=s.error||"Submission failed"}catch(o){n.value=o.message||"Error occurred"}finally{v.value=!1}})}function T(o){return o==="Approved"||o==="Paid"?"text-emerald-400 bg-emerald-500/10":o==="Rejected"?"text-red-400 bg-red-500/10":"text-amber-400 bg-amber-500/10"}return R(()=>{D()}),(o,e)=>(r(),a("div",G,[t("div",J,[e[9]||(e[9]=t("div",null,[t("h1",{class:"text-2xl sm:text-3xl font-bold text-white"},"Expenses"),t("p",{class:"text-sm text-slate-500 mt-1"},"Manage reimbursement claims")],-1)),t("button",{onClick:e[0]||(e[0]=s=>c.value=!0),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-teal-500 to-emerald-500 text-white rounded-xl shadow-lg shadow-teal-500/20 hover:shadow-teal-500/30 transition-all active:scale-95"},[d(u(L),{size:18}),e[8]||(e[8]=t("span",{class:"hidden sm:inline font-medium"},"New Claim",-1))])]),i.value?(r(),a("div",Q,[d(u(X),{size:18}),h(" "+m(i.value)+" ",1),t("button",{onClick:e[1]||(e[1]=s=>i.value=""),class:"ml-auto"},[d(u(M),{size:16})])])):k("",!0),y.value?(r(),a("div",W,[(r(),a(_,null,C(3,s=>t("div",{key:s,class:"glass-card p-6 h-32 animate-pulse"})),64))])):g.value.length===0?(r(),a("div",Y,[d(u(A),{size:48,class:"mb-4 opacity-20"}),e[10]||(e[10]=t("p",null,"No expense claims found",-1))])):(r(),a("div",Z,[(r(!0),a(_,null,C(g.value,s=>(r(),a("div",{key:s.name,class:"glass-card p-5 group hover:border-white/10 transition-colors"},[t("div",ee,[t("div",te,[d(u($),{size:20})]),t("span",{class:I(["px-2.5 py-1 rounded-full text-xs font-medium border border-white/5",T(s.approval_status)])},m(s.approval_status),3)]),t("div",se,[t("p",le,m(Number(s.total_claimed_amount).toLocaleString()),1),t("p",oe,m(s.name),1)]),t("div",ae,[t("div",re,[d(u(K),{size:14}),h(" "+m(new Date(s.posting_date).toLocaleDateString()),1)])])]))),128))])),c.value?(r(),a("div",ie,[t("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e[2]||(e[2]=s=>c.value=!1)}),t("div",ne,[t("button",{onClick:e[3]||(e[3]=s=>c.value=!1),class:"absolute right-4 top-4 text-slate-500 hover:text-white"},[d(u(M),{size:20})]),t("h2",de,[d(u(A),{class:"text-teal-400"}),e[11]||(e[11]=h(" New Expense Claim ",-1))]),t("form",{onSubmit:U(P,["prevent"]),class:"space-y-4"},[n.value?(r(),a("div",ue,[d(u(H),{size:16}),h(" "+m(n.value),1)])):k("",!0),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1.5 uppercase"},"Expense Type",-1)),S(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.expense_type=s),required:"",class:"w-full bg-slate-900/50 border border-white/10 rounded-lg px-3 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-teal-500/50"},[e[12]||(e[12]=t("option",{value:"",disabled:""},"Select Type",-1)),(r(!0),a(_,null,C(f.value,s=>(r(),a("option",{key:s,value:s},m(s),9,pe))),128))],512),[[B,l.value.expense_type]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1.5 uppercase"},"Amount",-1)),S(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.amount=s),type:"number",step:"0.01",required:"",placeholder:"0.00",class:"w-full bg-slate-900/50 border border-white/10 rounded-lg px-3 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-teal-500/50"},null,512),[[j,l.value.amount]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1.5 uppercase"},"Description",-1)),S(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.description=s),rows:"3",required:"",placeholder:"Reason for expense...",class:"w-full bg-slate-900/50 border border-white/10 rounded-lg px-3 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-teal-500/50"},null,512),[[j,l.value.description]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-xs font-medium text-slate-400 mb-1.5 uppercase"},"Proof (Bill/Receipt)",-1)),t("div",{class:"relative border-2 border-dashed border-white/10 rounded-lg p-4 text-center hover:border-teal-500/30 transition-colors cursor-pointer",onClick:e[7]||(e[7]=s=>{var x;return(x=b.value)==null?void 0:x.click()})},[t("input",{ref_key:"fileInput",ref:b,type:"file",class:"hidden",accept:"image/*,.pdf",onChange:F},null,544),d(u(O),{size:24,class:"mx-auto mb-2 text-slate-500"}),t("p",ce,m(l.value.proof?l.value.proof.name:"Click to upload proof"),1),e[16]||(e[16]=t("p",{class:"text-xs text-slate-500 mt-1"},"Image or PDF",-1))])]),t("button",{type:"submit",disabled:v.value,class:"w-full mt-4 bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-400 hover:to-emerald-400 text-white font-medium py-2.5 rounded-lg shadow-lg flex items-center justify-center gap-2"},[v.value?(r(),a("span",fe)):(r(),a("span",xe,"Submit Claim"))],8,me)],32)])])):k("",!0)]))}});export{Ce as default};
