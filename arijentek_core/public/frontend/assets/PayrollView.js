var D=(N,k,u)=>new Promise((x,c)=>{var f=d=>{try{h(u.next(d))}catch(v){c(v)}},p=d=>{try{h(u.throw(d))}catch(v){c(v)}},h=d=>d.done?x(d.value):Promise.resolve(d.value).then(f,p);h((u=u.apply(N,k)).next())});import{c as g,d as B,u as H,m as I,a as o,b as e,h as i,f as j,y as J,F as A,n as F,v as E,j as V,k as w,t as l,g as m,i as _,W as O,r as y,p as z,o as n}from"./main.js";import{p as C}from"./api.js";import{L as W,C as R}from"./loader-circle.js";import{C as $}from"./circle-check.js";import{C as q}from"./calendar.js";/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=g("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=g("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=g("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=g("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),te={key:0,class:"flex items-center justify-center py-20"},se={key:1,class:"space-y-6 animate-slide-up"},ae={key:0,class:"glass-card p-6"},le={class:"flex flex-wrap items-end gap-4"},ne=["value"],oe=["disabled"],re={key:0,class:"mt-4 flex items-start gap-2 text-sm text-red-400 bg-red-500/10 p-3 rounded-xl"},ie={key:1,class:"mt-4 flex items-center gap-2 text-sm text-emerald-400 bg-emerald-500/10 p-3 rounded-xl"},de={key:1,class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},ue={class:"glass-card-hover p-5"},ce={class:"flex items-center justify-between mb-3"},me={class:"w-9 h-9 rounded-xl bg-emerald-500/10 text-emerald-400 flex items-center justify-center"},xe={class:"text-2xl font-bold text-emerald-400"},pe={class:"glass-card-hover p-5"},ve={class:"flex items-center justify-between mb-3"},ye={class:"w-9 h-9 rounded-xl bg-blue-500/10 text-blue-400 flex items-center justify-center"},fe={class:"text-2xl font-bold text-blue-400"},he={class:"text-xs text-slate-500 mt-1"},be={class:"glass-card-hover p-5"},ge={class:"flex items-center justify-between mb-3"},ke={class:"w-9 h-9 rounded-xl bg-teal-500/10 text-teal-400 flex items-center justify-center"},we={class:"text-2xl font-bold text-teal-400"},_e={key:0,class:"space-y-3"},Me={class:"flex items-center gap-4"},De={class:"w-12 h-12 rounded-xl bg-accent/10 text-accent flex items-center justify-center shrink-0"},ze={class:"text-base font-semibold text-white"},Ce={class:"text-xs text-slate-500"},Ne={class:"flex items-center gap-6 sm:gap-8"},Se={class:"text-sm font-semibold text-slate-300"},Pe={class:"text-sm font-bold text-emerald-400"},je=["onClick"],Ae={key:1,class:"glass-card p-12 text-center"},Be=B({__name:"PayrollView",setup(N){const k=H(),u=y(!0),x=y(!1),c=y(""),f=y(""),p=new Date,h=p.getMonth()===0?12:p.getMonth(),d=p.getMonth()===0?p.getFullYear()-1:p.getFullYear(),v=y(h),M=y(d),r=y([]),S=z(()=>r.value.reduce((s,t)=>s+(t.net_pay||0),0)),L=z(()=>r.value.reduce((s,t)=>s+(t.gross_pay||0),0)),Y=z(()=>r.value.length?Math.round(S.value/r.value.length):0);function b(s){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function T(s){k.csrfToken||window.csrf_token;const t=C.getDownloadUrl(s);window.open(t,"_blank")}function P(){return D(this,null,function*(){u.value=!0;try{const s=yield C.getSlips();r.value=Array.isArray(s)?s:[]}catch(s){r.value=[]}finally{u.value=!1}})}function G(){return D(this,null,function*(){x.value=!0,c.value="",f.value="";try{const s=yield C.generatePayroll(v.value,M.value);s!=null&&s.success?(f.value=s.message||"Payroll generated successfully",yield P()):c.value=(s==null?void 0:s.error)||"Failed to generate payroll"}catch(s){c.value=(s==null?void 0:s.message)||"Something went wrong"}finally{x.value=!1}})}const U=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}];return I(P),(s,t)=>(n(),o("div",null,[t[18]||(t[18]=e("div",{class:"mb-8 animate-fade-in"},[e("h1",{class:"text-2xl sm:text-3xl font-bold text-white"},"Payroll"),e("p",{class:"text-sm text-slate-500 mt-1"},"View and download your salary slips")],-1)),u.value?(n(),o("div",te,[...t[2]||(t[2]=[e("div",{class:"w-10 h-10 border-2 border-accent/30 border-t-accent rounded-full animate-spin"},null,-1)])])):(n(),o("div",se,[i(k).hasPayrollPermission?(n(),o("div",ae,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"},"Generate Payslips",-1)),t[6]||(t[6]=e("p",{class:"text-sm text-slate-500 mb-4"},"Create salary slips for all eligible employees for the selected month",-1)),e("div",le,[e("div",null,[t[3]||(t[3]=e("label",{class:"block text-xs font-medium text-slate-400 mb-1.5"},"Month",-1)),j(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),class:"input-dark w-40"},[(n(),o(A,null,F(U,a=>e("option",{key:a.value,value:a.value},l(a.label),9,ne)),64))],512),[[J,v.value,void 0,{number:!0}]])]),e("div",null,[t[4]||(t[4]=e("label",{class:"block text-xs font-medium text-slate-400 mb-1.5"},"Year",-1)),j(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>M.value=a),type:"number",min:"2020",max:"2030",class:"input-dark w-24"},null,512),[[E,M.value,void 0,{number:!0}]])]),e("button",{onClick:G,disabled:x.value,class:"btn-accent flex items-center gap-2 px-5 py-2.5"},[x.value?(n(),V(i(W),{key:0,size:18,class:"animate-spin"})):(n(),V(i(Z),{key:1,size:18,"stroke-width":1.8})),w(" "+l(x.value?"Generating...":"Generate Payroll"),1)],8,oe)]),c.value?(n(),o("div",re,[m(i(R),{size:16,class:"mt-0.5 shrink-0"}),w(" "+l(c.value),1)])):_("",!0),f.value?(n(),o("div",ie,[m(i($),{size:16,class:"shrink-0"}),w(" "+l(f.value),1)])):_("",!0)])):_("",!0),r.value.length?(n(),o("div",de,[e("div",ue,[e("div",ce,[t[7]||(t[7]=e("span",{class:"text-sm font-medium text-slate-400"},"Avg Net Pay",-1)),e("div",me,[m(i(ee),{size:18,"stroke-width":1.8})])]),e("p",xe,l(b(Y.value)),1),t[8]||(t[8]=e("p",{class:"text-xs text-slate-500 mt-1"},"per month",-1))]),e("div",pe,[e("div",ve,[t[9]||(t[9]=e("span",{class:"text-sm font-medium text-slate-400"},"YTD Gross",-1)),e("div",ye,[m(i(K),{size:18,"stroke-width":1.8})])]),e("p",fe,l(b(L.value)),1),e("p",he,l(r.value.length)+" slip"+l(r.value.length!==1?"s":""),1)]),e("div",be,[e("div",ge,[t[10]||(t[10]=e("span",{class:"text-sm font-medium text-slate-400"},"YTD Net",-1)),e("div",ke,[m(i(O),{size:18,"stroke-width":1.8})])]),e("p",we,l(b(S.value)),1),t[11]||(t[11]=e("p",{class:"text-xs text-slate-500 mt-1"},"total credited",-1))])])):_("",!0),e("div",null,[t[17]||(t[17]=e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4"},"Salary Slips",-1)),r.value.length?(n(),o("div",_e,[(n(!0),o(A,null,F(r.value,a=>(n(),o("div",{key:a.name,class:"glass-card-hover p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[e("div",Me,[e("div",De,[m(i(q),{size:20,"stroke-width":1.8})]),e("div",null,[e("p",ze,l(a.month)+" "+l(a.year),1),e("p",Ce,l(new Date(a.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" â€” "+l(new Date(a.end_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),1)])]),e("div",Ne,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-xs text-slate-500"},"Gross",-1)),e("p",Se,l(b(a.gross_pay)),1)]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-xs text-slate-500"},"Net Pay",-1)),e("p",Pe,l(b(a.net_pay)),1)])]),e("button",{onClick:Fe=>T(a.name),class:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/[0.04] hover:bg-white/[0.08] border border-white/[0.06] text-sm font-medium text-slate-300 hover:text-white transition-all self-start sm:self-center shrink-0"},[m(i(Q),{size:16,"stroke-width":1.8}),t[14]||(t[14]=w(" Download ",-1))],8,je)]))),128))])):(n(),o("div",Ae,[m(i(X),{size:40,class:"mx-auto text-slate-600 mb-3"}),t[15]||(t[15]=e("p",{class:"text-slate-400 font-medium"},"No salary slips found",-1)),t[16]||(t[16]=e("p",{class:"text-sm text-slate-500 mt-1"},"Your payslips will appear here once processed",-1))]))])]))]))}});export{Be as default};
